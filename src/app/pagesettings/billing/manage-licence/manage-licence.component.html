<div>
  <nav aria-label="breadcrumb" style="margin-left: -14px">
    <ol class="breadcrumb breadcrumb-style1 mg-b-10">
      <li class="breadcrumb-item">Billing</li>
      <li class="breadcrumb-item active">Manage Licenses</li>

    </ol>
  </nav>
   <h4 class="mg-b-0 tx-spacing--1">Manage Licenses</h4>
</div>
<div *ngIf="isSuccess" class="mb-0 mt-3 alert alert-success">
  <strong> Payment Received!</strong> Thanks for the payment - Your Product added on Active Products & Plans
</div>

<div *ngIf="showManageText" class="mb-0 mt-3 alert alert-info">
  <strong> Updated </strong> Your Subscription has been Successful updated
</div>

<div *ngIf="isError" class="mb-0 mt-3 alert alert-danger">
  <strong>Error!</strong> Something went Wrong...
</div>

<div class="card mt-4">
  <div class="row">
    <div class="col-md-7">
      <h4 class="mt-4 pl-4 cl-gray">Active Products & Plans</h4>
    </div>
    <div class="col-md-5 text-right">
      <a routerLink="/settings/billing/pricing" class="btn add-sub-btn mt-4 ml-0 btn-default">
        <i class="fa fa-plus pr-1" style="color:#11188f;" aria-hidden="true"></i>  Add Subscription</a>

      <button (click)="onGenerateSessionID()" type="button" class="btn pull-left mt-4 ml-2 mr-2 btn-primary"><i class="fa fa-cogs pr-1" aria-hidden="true"></i>
         Manage Subscription</button>
    </div>
  </div>

  <div class="card-body mt-2">
    <ng-container *ngIf="!skLoading">
    <table class="table">
      <thead>
      <tr>
        <th>Product Name</th>
        <th>Plan Name</th>
        <th style="width: 150px">Available Licenses</th>
        <th>Total Licenses</th>
        <th>Valid Up to</th>
        <th>Price</th>
        <th>Pay By</th>
      </tr>
      </thead>
      <ng-container *ngIf="activeSubscriptionList.length > 0">
      <tbody>
      <tr *ngFor="let plan of activeSubscriptionList">
        <ng-container *ngIf="plan.active">
        <td *ngIf="plan.planDetails.level === 'property'" style="width: 320px"><a class="plan-name" [routerLink]="'/settings/billing/manage/property'"
          [queryParams]="{planid: plan.id, plan_name: plan.plan_name,
             total_licence: plan.total_licence, assigned_licence: plan.assigned_licence,
              product_name: plan.planDetails.product_name
            }">
           {{plan.planDetails.product_name}}</a></td>

           <td *ngIf="plan.planDetails.level !== 'property'" style="width: 320px"><a class="plan-name" [routerLink]="'/settings/billing/manage/organizations'"
            [queryParams]="{planid: plan.id, plan_name: plan.plan_name,
               total_licence: plan.total_licence, assigned_licence: plan.assigned_licence,
                product_name: plan.planDetails.product_name
              }">
             {{plan.planDetails.product_name}}</a></td>


           <td style="width: 150px">{{plan.plan_name}}</td>
        <td style="width: 10px" >{{ plan.total_licence - plan.assigned_licence}} </td>
        <td style="width: 200px">
          <div class="row">
            <div class="col-md-7 p-0">
            <div class="progress mt-1" style="height:8px">
            <div class="progress-bar" [ngStyle]="{width:  onCalculateOptValue(plan.assigned_licence, plan.total_licence)+'%'}" style=" background-color: #11188f">
            </div>
            <div class="progress-bar"  [ngStyle]="{width:  100 - onCalculateOptValue(plan.assigned_licence, plan.total_licence) +'%'}" style="background-color: #3d78d4">
            </div>
          </div>
        </div>
        <div class="col-md-5">
         <span style="font-weight: 600"> {{plan.assigned_licence}} / {{plan.total_licence}}</span>
        </div>
        </div>

        </td>
        <td style="width: 280px"> <i class="fa fa-check-circle pr-2" aria-hidden="true"></i> Active: Renews on  {{plan.planDetails.plan_ends | date}}</td>
        <td style="width: 120px">{{plan.planDetails.price + '.00 ' + plan.currency | uppercase}}  </td>
        <th style="width: 170px;text-transform: capitalize;">**** <span class="pr-1">{{plan.planDetails.card_number}}</span>

          <span *ngIf="plan.planDetails.brand !== 'mastercard' && plan.planDetails.brand !== 'visa' && plan.planDetails.brand !== 'amex'">{{' ' + plan.planDetails.brand}}</span>
          <img *ngIf="plan.planDetails.brand === 'mastercard'" alt="Credit Card Logos" title="Credit Card Logos" src="assets/card-logo/mc.png" width="40" height="25" border="0" />
          <img *ngIf="plan.planDetails.brand === 'visa'" alt="Credit Card Logos" title="Credit Card Logos" src="assets/card-logo/visa.gif" width="35" height="16" border="0" />
          <img *ngIf="plan.planDetails.brand === 'amex'" alt="Credit Card Logos" title="Credit Card Logos" src="/assets/card-logo/amex.gif" width="35" height="22" border="0" />

        </th>

        </ng-container>
      </tr>
    </tbody>
</ng-container>
    </table>
    <ng-container *ngIf="activeSubscriptionList.length == 0">
      <div class="alert cs-alert w-100 alert-info">You don't have any active plan</div>
      </ng-container>
      </ng-container>
      <ngx-skeleton-loader  *ngIf="skLoading" count="6" class="pt-4"></ngx-skeleton-loader>

  </div>
</div>



<div class="card mt-4">
  <h4 class="mt-4 pl-4">Expired Products & Plans</h4>
  <div class="card-body mt-2">
    <ng-container *ngIf="!skLoading">
      <table class="table">
        <thead>
        <tr>
          <th>Product Name</th>
          <th>Plan Name</th>
          <th style="width: 150px">Available Licenses</th>
          <th>Total Licenses</th>
          <th>Valid Up to</th>
          <th>Price</th>
          <th>Pay By</th>
        </tr>
        </thead>
        <ng-container *ngIf="inActiveplans.length > 0">
        <tbody>
        <tr *ngFor="let plan of inActiveplans">
          <td *ngIf="plan.planDetails.level === 'property'" style="width: 320px"><a class="plan-name" [routerLink]="'/settings/billing/manage/property'"
            [queryParams]="{planid: plan.id, plan_name: plan.plan_name,
               total_licence: plan.total_licence, assigned_licence: plan.assigned_licence,
                product_name: plan.planDetails.product_name
              }">
             {{plan.planDetails.product_name}}</a></td>

             <td *ngIf="plan.planDetails.level !== 'property'" style="width: 320px"><a class="plan-name" [routerLink]="'/settings/billing/manage/organizations'"
              [queryParams]="{planid: plan.id, plan_name: plan.plan_name,
                 total_licence: plan.total_licence, assigned_licence: plan.assigned_licence,
                  product_name: plan.planDetails.product_name
                }">
               {{plan.planDetails.product_name}}</a></td>


             <td style="width: 150px">{{plan.plan_name}}</td>
          <td style="width: 10px" >{{ plan.total_licence - plan.assigned_licence}} </td>
          <td style="width: 200px">
            <div class="row">
              <div class="col-md-7 p-0">
              <div class="progress mt-1" style="height:8px">
              <div class="progress-bar" [ngStyle]="{width:  onCalculateOptValue(plan.assigned_licence, plan.total_licence)+'%'}" style=" background-color: #11188f">
              </div>
              <div class="progress-bar"  [ngStyle]="{width:  100 - onCalculateOptValue(plan.assigned_licence, plan.total_licence) +'%'}" style="background-color: #3d78d4">
              </div>
            </div>
          </div>
          <div class="col-md-5">
           <span style="font-weight: 600"> {{plan.assigned_licence}} / {{plan.total_licence}}</span>
          </div>
          </div>

          </td>
          <td style="width: 280px"> <i class="fa fa-times-circle pr-2" aria-hidden="true"></i>Expired on {{plan.planDetails.plan_ends | date}}</td>
          <td style="width: 120px">{{plan.planDetails.price + '.00 ' + plan.currency | uppercase}}  </td>
          <th style="width: 170px;text-transform: capitalize;">**** <span class="pr-1">{{plan.planDetails.card_number}}</span>

            <span *ngIf="plan.planDetails.brand !== 'mastercard' && plan.planDetails.brand !== 'visa' && plan.planDetails.brand !== 'amex'">{{ ' ' + plan.planDetails.brand}}</span>
            <img *ngIf="plan.planDetails.brand === 'mastercard'" alt="Credit Card Logos" title="Credit Card Logos" src="assets/card-logo/mc.png" width="40" height="25" border="0" />
            <img *ngIf="plan.planDetails.brand === 'visa'" alt="Credit Card Logos" title="Credit Card Logos" src="assets/card-logo/visa.gif" width="35" height="16" border="0" />
            <img *ngIf="plan.planDetails.brand === 'amex'" alt="Credit Card Logos" title="Credit Card Logos" src="/assets/card-logo/amex.gif" width="35" height="22" border="0" />

          </th>

        </tr>
      </tbody>
  </ng-container>
      </table>
      <ng-container *ngIf="inActiveplans.length == 0">
        <div class="alert cs-alert w-100 alert-info">There is no expired plan</div>
        </ng-container>
        </ng-container>
        <ngx-skeleton-loader  *ngIf="skLoading" count="6" class="pt-4"></ngx-skeleton-loader>
  </div>
</div>

<div class="col-sm-5 mt-3 mr-0 float-right">
  <alert *ngIf="isOpen" [type]="alertType"  dismissOnTimeout="5000">{{  alertMsg}}</alert>
</div>
